<!DOCTYPE html>
<html class="no-js" lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>{{ articleSingle.title }} - {{ OPT.siteName }}</title>
    <meta name="description" content="{{ OPT.siteDescription }}">
    <meta name="keywords" content="{{ articleSingle.tags }}">
    <link rel="canonical" href="{{ OPT.siteUrl }}{{ articleSingle.url }}">
    {{{ OPT.codeBeforHead }}}
    <link rel='stylesheet' id='font-awesome-css' href='{{ &OPT.theme_github_path }}JustNews/files/font-awesome.css' type='text/css' media='all' />
    <link rel='stylesheet' id='style-css' href='{{ &OPT.theme_github_path }}JustNews/files/style.min.css' type='text/css' media='all' />
    <link rel='stylesheet' id='main-css' href='{{ &OPT.theme_github_path }}JustNews/files/main.css' type='text/css' media='all' />
    <link rel="stylesheet" href="{{ &OPT.theme_github_path }}JustNews/files/fonts/fontawesome5pro-all.min.css">
    <style>
        .cat-links a {
            margin-right: 5px;
        }
    </style>
</head>

<body class="post-template-default single single-post single-format-standard">
    <div id="page" class="site">
        <header id="masthead" class="site-header">
            <div class="header-main">
                <div class="container">
                    <div class="row">
                        <div class="site-branding col-md-3">
                            <h1 class="site-title">
                                <a href="/" title="{{ OPT.siteName }}" rel="home">
                                    <img src="{{ OPT.logo }}" alt="{{ OPT.siteName }}">
                                </a>
                            </h1>
                        </div>
                        <div id="main-navigation" class="main-navigation col-md-9">
                            <ul id="menu-primary-items" class="menu">
                                {{#widgetMenuList}}
                                <li><a href="{{ url }}">{{ title }}</a></li>
                                {{/widgetMenuList}}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <div id="content" class="site-content">
            <div class="container">
                <div class="row">
                    <div id="primary" class="content-area col-md-8">
                        <main id="main" class="site-main" role="main">
                            {{#articleSingle}}
                            <article class="post type-post status-publish format-standard has-post-thumbnail hentry">
                                <header class="entry-header">
                                    <h1 class="entry-title">{{ title }}</h1>
                                    <div class="entry-meta">
                                        <span class="posted-on">
                                            <i class="fas fa-calendar-alt"></i>
                                            <time class="entry-date published">{{ createDate }}</time>
                                        </span>
                                        <span class="cat-links">
                                            <i class="fas fa-folder-open"></i>
                                            {{#categories}}
                                            <a href="/category/{{name}}/" rel="category tag">
                                                <i class="{{icon}}"></i> {{name}}
                                            </a>
                                            {{/categories}}
                                        </span>
                                    </div>
                                </header>
                                <div class="entry-content">
                                    {{{ contentHtml }}}
                                </div>
                                <footer class="entry-footer">
                                    <span class="tags-links">
                                        <i class="fas fa-tags"></i>
                                        {{#tags}}
                                        <a href="/tags/{{.}}/" rel="tag">{{.}}</a>
                                        {{/tags}}
                                    </span>
                                </footer>
                            </article>
                            {{/articleSingle}}

                            <nav class="navigation post-navigation" role="navigation">
                                <h2 class="screen-reader-text">文章导航</h2>
                                <div class="nav-links">
                                    {{#articleNewer}}
                                    <div class="nav-previous">
                                        <a href="{{ url }}" rel="prev"><span class="meta-nav" aria-hidden="true">上一篇</span>
                                            <span class="post-title">{{ title }}</span></a>
                                    </div>
                                    {{/articleNewer}}
                                    {{#articleOlder}}
                                    <div class="nav-next">
                                        <a href="{{ url }}" rel="next"><span class="meta-nav" aria-hidden="true">下一篇</span>
                                            <span class="post-title">{{ title }}</span></a>
                                    </div>
                                    {{/articleOlder}}
                                </div>
                            </nav>

                             <div id="comments" class="comments-area">
                                <h2 class="comments-title">发表评论</h2>
                                <div id="respond" class="comment-respond">
                                    <form id="commentform" class="comment-form">
                                        <p class="comment-form-comment">
                                            <textarea id="comment" name="comment" cols="45" rows="8" required="required"></textarea>
                                        </p>
                                        <p class="form-submit">
                                            <input name="submit" type="submit" id="submit" class="submit" value="发表评论" />
                                        </p>
                                    </form>
                                </div>
                                <ol class="comment-list"></ol>
                            </div>
                        </main>
                    </div>
                    <div id="secondary" class="widget-area col-md-4" role="complementary">
						<aside id="categories-2" class="widget widget_categories">
							<h3 class="widget-title"><span>分类</span></h3>
							<ul>
								{{#widgetCategoryList}}
								<li class="cat-item">
									<a href="/category/{{name}}/"><i class="{{icon}} fa-fw"></i> {{name}}</a>
								</li>
								{{/widgetCategoryList}}
							</ul>
						</aside>
						<aside id="recent-posts-2" class="widget widget_recent_entries">
							<h3 class="widget-title"><span>近期文章</span></h3>
							<ul>
								{{#widgetRecentlyList}}
								<li>
									<a href="{{url}}">{{title}}</a>
								</li>
								{{/widgetRecentlyList}}
							</ul>
						</aside>
                         <aside id="custom_html-2" class="widget_text widget widget_custom_html">
                            <h3 class="widget-title"><span>标签</span></h3>
                            <div class="textwidget custom-html-widget">
                                <div class="tagcloud">
                                    {{#widgetTagList}}
                                    <a href="/tags/{{.}}/" class="tag-cloud-link">{{.}}</a>
                                    {{/widgetTagList}}
                                </div>
                            </div>
                        </aside>
                        <aside id="linkcat-2" class="widget widget_links">
                            <h3 class="widget-title"><span>链接</span></h3>
                            <ul class='xoxo blogroll'>
                                {{#widgetLinkList}}
                                <li><a href="{{url}}" target="_blank">{{title}}</a></li>
                                {{/widgetLinkList}}
                            </ul>
                        </aside>
					</div>
                </div>
            </div>
        </div>
        <footer id="colophon" class="site-footer">
            <div class="container">
                <div class="site-info">
                    {{ OPT.copyRight }} {{ OPT.siteName }}
                </div>
            </div>
        </footer>
    </div>
    {{{ OPT.codeBeforBody }}}
    <script type='text/javascript' src='{{ &OPT.theme_github_path }}JustNews/files/jquery.min.js'></script>
    <script type='text/javascript' src='{{ &OPT.theme_github_path }}JustNews/files/main.js'></script>
    <script>
        $(document).ready(function() {
            const articleId = "{{articleSingle.id}}"; 
            const articleLink = "{{articleSingle.link}}";
            const articleSlug = `${articleId}/${articleLink}`;

            function loadComments() {
                if (!articleSlug) return;
                $.getJSON(`/api/comments/${articleSlug}`, function(comments) {
                    const commentList = $('.comment-list').empty();
                    if (comments && comments.length > 0) {
                        comments.forEach(function(comment) {
                            commentList.append(`<li><article class="comment-body"><div class="comment-content"><p>${comment.content}</p></div></article></li>`);
                        });
                    }
                });
            }
            
            $('#commentform').on('submit', function(e) {
                e.preventDefault();
                const commentContent = $('#comment').val();
                if (!commentContent.trim()) {
                    alert('评论内容不能为空！');
                    return;
                }

                $.ajax({
                    url: `/api/comments/${articleSlug}`,
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ content: commentContent }),
                    success: function() {
                        $('#comment').val('');
                        loadComments();
                    },
                    error: function() {
                        alert('发表评论失败！');
                    }
                });
            });

            loadComments();
        });
    </script>
</body>
</html>
