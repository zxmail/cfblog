<!DOCTYPE html>
<html class="no-js" lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>{{ OPT.title }}</title>
    <meta name="description" content="{{ OPT.siteDescription }}">
    <meta name="keywords" content="{{ OPT.keyWords }}">
    <link rel="canonical" href="{{ OPT.siteUrl }}">
    {{{ OPT.codeBeforHead }}}
    <link rel='stylesheet' id='font-awesome-css' href='{{ &OPT.theme_github_path }}JustNews/files/font-awesome.css' type='text/css' media='all' />
    <link rel='stylesheet' id='style-css' href='{{ &OPT.theme_github_path }}JustNews/files/style.min.css' type='text/css' media='all' />
    <link rel='stylesheet' id='main-css' href='{{ &OPT.theme_github_path }}JustNews/files/main.css' type='text/css' media='all' />
    <link rel="stylesheet" href="{{ &OPT.theme_github_path }}JustNews/files/fonts/fontawesome5pro-all.min.css">
    <style>
        .cat-links a {
            margin-right: 5px;
        }
    </style>
</head>

<body class="post-template-default single single-post single-format-standard">
    <div id="page" class="site">
        <header id="masthead" class="site-header">
            </header>
        <div id="content" class="site-content">
            <div class="container">
                <div class="row">
                    <div id="primary" class="content-area col-md-8">
                        <main id="main" class="site-main" role="main">
                            {{#articleSingle}}
                            <article class="post type-post status-publish format-standard has-post-thumbnail hentry">
                                <header class="entry-header">
                                    <h1 class="entry-title">{{ title }}</h1>
                                    <div class="entry-meta">
                                        <span class="posted-on">
                                            <i class="fas fa-calendar-alt"></i>
                                            <time class="entry-date published">{{ createDate10 }}</time>
                                        </span>
                                        <span class="cat-links">
                                            <i class="fas fa-folder-open"></i>
                                            {{#categories}}
                                            <a href="/category/{{name}}/" rel="category tag">
                                                <i class="{{icon}}"></i> {{name}}
                                            </a>
                                            {{/categories}}
                                        </span>
                                    </div>
                                </header>
                                <div class="entry-content">
                                    {{{ contentHtml }}}
                                </div>
                                <footer class="entry-footer">
                                    <span class="tags-links">
                                        <i class="fas fa-tags"></i>
                                        {{#tags}}
                                        <a href="/tags/{{.}}/" rel="tag">{{.}}</a>
                                        {{/tags}}
                                    </span>
                                </footer>
                            </article>
                            {{/articleSingle}}

                            <div id="comments" class="comments-area">
                                <h2 class="comments-title">发表评论</h2>
                                <div id="respond" class="comment-respond">
                                    <form id="commentform" class="comment-form">
                                        <p class="comment-form-comment">
                                            <textarea id="comment" name="comment" cols="45" rows="8" required="required"></textarea>
                                        </p>
                                        <p class="form-submit">
                                            <input name="submit" type="submit" id="submit" class="submit" value="发表评论" />
                                        </p>
                                    </form>
                                </div>
                                <ol class="comment-list"></ol>
                            </div>
                        </main>
                    </div>
                    <div id="secondary" class="widget-area col-md-4" role="complementary">
                        </div>
                </div>
            </div>
        </div>
        <footer id="colophon" class="site-footer">
            </footer>
    </div>
    {{{ OPT.codeBeforBody }}}
    <script type='text/javascript' src='{{ &OPT.theme_github_path }}JustNews/files/jquery.min.js'></script>
    <script type='text/javascript' src='{{ &OPT.theme_github_path }}JustNews/files/main.js'></script>
    <script>
        // Comments submission logic
        $(document).ready(function() {
            const articleId = "{{articleSingle.id}}"; // Get article ID from template

            function loadComments() {
                if (!articleId) return;
                $.getJSON(`/api/comments/${articleId}`, function(comments) {
                    const commentList = $('.comment-list').empty();
                    if (comments && comments.length > 0) {
                        comments.forEach(function(comment) {
                            commentList.append(`<li><article class="comment-body"><div class="comment-content"><p>${comment.content}</p></div></article></li>`);
                        });
                    }
                });
            }
            
            $('#commentform').on('submit', function(e) {
                e.preventDefault();
                const commentContent = $('#comment').val();
                if (!commentContent.trim()) {
                    alert('评论内容不能为空！');
                    return;
                }

                $.ajax({
                    url: `/api/comments/${articleId}`,
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ content: commentContent }),
                    success: function() {
                        $('#comment').val('');
                        loadComments();
                    },
                    error: function() {
                        alert('发表评论失败！');
                    }
                });
            });

            loadComments();
        });
    </script>
</body>
</html>
